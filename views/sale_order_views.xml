<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Inherit Sale Order Form View -->
    <record id="sale_order_form_inherit_smart_notifier" model="ir.ui.view">
        <field name="name">sale.order.form.inherit.smart.notifier</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <!-- Add Smart Notification button -->
            <xpath expr="//header" position="inside">
                <button name="action_send_smart_notification" 
                        string="ðŸ¤– AI Analysis" 
                        type="object" 
                        class="btn-primary"
                        icon="fa-magic"
                        groups="sales_team.group_sale_salesman"
                        invisible="state not in ('sale', 'done')"/>
            </xpath>
            
            <!-- Add Smart Notification tab -->
            <xpath expr="//notebook" position="inside">
                <page string="ðŸ¤– AI Analysis" name="smart_notifier">
                    <div class="alert alert-info" role="alert" invisible="smart_notified == True">
                        <strong>ðŸ’¡ Tip:</strong> Click the "ðŸ¤– AI Analysis" button to get AI-powered insights for this order.
                    </div>
                    <group invisible="smart_notified == False">
                        <group string="ðŸ“Š Analysis Status">
                            <field name="smart_notified" widget="boolean_toggle" readonly="1"/>
                            <field name="smart_notification_date" readonly="1"/>
                            <field name="priority_score" readonly="1"/>
                        </group>
                        <group string="ðŸ“ˆ Order Summary">
                            <field name="amount_total" string="Total Amount"/>
                            <field name="partner_id" string="Customer"/>
                            <field name="date_order" string="Order Date"/>
                        </group>
                    </group>
                    <group string="ðŸ¤– AI-Generated Insights" invisible="smart_notified == False">
                        <field name="ai_analysis" readonly="1" nolabel="1" colspan="2" 
                               placeholder="AI analysis will appear here after processing..."/>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Inherit Sale Order Tree View -->
    <record id="sale_order_tree_inherit_smart_notifier" model="ir.ui.view">
        <field name="name">sale.order.tree.inherit.smart.notifier</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='state']" position="after">
                <field name="smart_notified" string="ðŸ¤– AI" widget="boolean_toggle" optional="show"/>
                <field name="priority_score" string="Priority" optional="show"/>
            </xpath>
        </field>
    </record>

    <!-- Action to open AI-analyzed orders -->
    <record id="action_sale_orders_ai_analyzed" model="ir.actions.act_window">
        <field name="name">AI Analyzed Orders</field>
        <field name="res_model">sale.order</field>
        <field name="view_mode">tree,form,kanban</field>
        <field name="domain">[('smart_notified', '=', True)]</field>
        <field name="context">{'search_default_smart_notified': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No AI-analyzed orders yet
            </p>
            <p>
                Click the "ðŸ¤– AI Analysis" button on a confirmed sales order to get AI-powered insights.
            </p>
        </field>
    </record>

    <!-- Menu item for AI Analyzed Orders -->
    <menuitem id="menu_sale_orders_ai"
              name="ðŸ¤– AI Insights"
              parent="sale.sale_order_menu"
              action="action_sale_orders_ai_analyzed"
              sequence="99"/>

</odoo>
